"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var IO=_interopDefault(require("socket.io-client")),config={serverUrl:"http://hamonisync-env-2.mgddeenjpq.eu-west-1.elasticbeanstalk.com"},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),Value=function(){function t(e,n,a,i){var o=this;classCallCheck(this,t),this._io=n,this._stateName=a,this._state=i,this._UpdateCallbacks=[],this._syncCallbacks=[],this._io.on("value-updated-"+e+"-"+a,function(t){o._state=t,o._UpdateCallbacks.forEach(function(e){return e(t.data)})}),this._io.on("reconnect",function(){o._io.emit("get-state",o._stateName,function(t){t.error||t.rev!==o._state.rev&&(o._state=t,o._syncCallbacks.forEach(function(e){return e(t.data)}))})})}return createClass(t,[{key:"update",value:function(t){if(null===t||void 0===t)throw Error("State cannot be empty");if("function"==typeof t||"object"===(void 0===t?"undefined":_typeof(t)))throw Error("State has an invalid type");this._io.emit("update-value",{name:this._stateName,rev:this._state.rev,state:t})}},{key:"onUpdated",value:function(t){if("function"!=typeof t)throw Error("Expect a function but got an invalid parameter type");this._UpdateCallbacks.push(t)}},{key:"onSync",value:function(t){if("function"!=typeof t)throw Error("Expected a function but got an invalid parameter type");this._syncCallbacks.push(t)}},{key:"get",value:function(){return this._state.data}}]),t}(),Obj=function(){function t(e,n,a,i){var o=this;classCallCheck(this,t),this._io=n,this._stateName=a,this._state=i,this._UpdateCallbacks=[],this._syncCallbacks=[],this._io.on("object-updated-"+e+"-"+a,function(t){o._state=t,o._UpdateCallbacks.forEach(function(e){return e(t.data)})}),this._io.on("reconnect",function(){o._io.emit("get-state",o._stateName,function(t){t.error||t.rev!==o._state.rev&&(o._state=t,o._syncCallbacks.forEach(function(e){return e(t.data)}))})})}return createClass(t,[{key:"update",value:function(t){if("object"!==(void 0===t?"undefined":_typeof(t))||null===t||void 0===t)throw Error("State is invalid");this._io.emit("update-object",{name:this._stateName,rev:this._state.rev,state:t})}},{key:"onUpdated",value:function(t){if("function"!=typeof t)throw Error("Expect a function but got an invalid parameter type");this._UpdateCallbacks.push(t)}},{key:"onSync",value:function(t){if("function"!=typeof t)throw Error("Expected a function but got an invalid parameter type");this._syncCallbacks.push(t)}},{key:"get",value:function(){return this._state.data}}]),t}(),List=function(){function t(e,n,a,i){var o=this;classCallCheck(this,t),this._io=n,this._stateName=a,this._state=i,this._itemUpdatedCallbacks=[],this._itemRemovedCallbacks=[],this._itemAddedCallbacks=[],this._resetCallbacks=[],this._syncCallbacks=[],this._io.on("item-updated-"+e+"-"+a,function(t){o._state.rev=t.rev,o._state.data[t.data.index]=t.data.value,o._itemUpdatedCallbacks.forEach(function(e){return e(t.data)})}),this._io.on("item-deleted-"+e+"-"+a,function(t){o._state.rev=t.rev,o._state.data.splice(t.data.index,1),o._itemRemovedCallbacks.forEach(function(e){return e(t.data)})}),this._io.on("item-added-"+e+"-"+a,function(t){o._state.rev=t.rev,o._state.data[t.data.index]=t.data.value,o._itemAddedCallbacks.forEach(function(e){return e(t.data)})}),this._io.on("list-reset-"+e+"-"+a,function(t){o._state.rev=t.rev,o._state.data=t.data,o._resetCallbacks.forEach(function(e){return e(t.data)})}),this._io.on("reconnect",function(){o._io.emit("get-state",o._stateName,function(t){t.error||t.rev!==o._state.rev&&(o._state=t,o._syncCallbacks.forEach(function(e){return e(t.data)}))})})}return createClass(t,[{key:"onReset",value:function(t){if("function"!=typeof t)throw Error("Expected a function but got an invalid parameter type");this._resetCallbacks.push(t)}},{key:"onItemAdded",value:function(t){if("function"!=typeof t)throw Error("Expected a function but got an invalid parameter type");this._itemAddedCallbacks.push(t)}},{key:"onItemUpdated",value:function(t){if("function"!=typeof t)throw Error("Expected a function but got an invalid parameter type");this._itemUpdatedCallbacks.push(t)}},{key:"onItemRemoved",value:function(t){if("function"!=typeof t)throw Error("Expected a function but got an invalid parameter type");this._itemRemovedCallbacks.push(t)}},{key:"onItemDeleted",value:function(t){if(console.warn("This method is deprecated and will not be usable in future versions. Use onItemRemoved() instead. See https://docs.hamoni.tech/list-primitive.html for more info"),"function"!=typeof t)throw Error("Expected a function but got an invalid parameter type");this._itemRemovedCallbacks.push(t)}},{key:"onSync",value:function(t){if("function"!=typeof t)throw Error("Expected a function but got an invalid parameter type");this._syncCallbacks.push(t)}},{key:"update",value:function(t,e){if(null===e||void 0===e)throw Error("State is invalid");this._io.emit("list-update",{name:this._stateName,rev:this._state.rev,state:{value:e,index:t}})}},{key:"remove",value:function(t){if(isNaN(t))throw Error("Index is invalid");if(!this._state.data[t])throw Error("There's no item at the specified index");this._io.emit("list-delete",{name:this._stateName,rev:this._state.rev,state:{index:t}})}},{key:"delete",value:function(t){if(console.warn("This method is deprecated and will not be usable in future versions. Use remove() instead. See https://docs.hamoni.tech/list-primitive.html for more info"),isNaN(t))throw Error("Index is invalid");if(!this._state.data[t])throw Error("There's no item at the specified index");this._io.emit("list-delete",{name:this._stateName,rev:this._state.rev,state:{index:t}})}},{key:"add",value:function(t){if(null===t||void 0===t)throw Error("State is invalid");this._io.emit("list-push",{name:this._stateName,rev:this._state.rev,state:t})}},{key:"push",value:function(t){if(console.warn("This method is deprecated and will not be usable in future versions. Use add() instead. See https://docs.hamoni.tech/list-primitive.html for more info"),null===t||void 0===t)throw Error("State is invalid");this._io.emit("list-push",{name:this._stateName,rev:this._state.rev,state:t})}},{key:"set",value:function(t){if("Array"!==t.constructor.name||null===t||void 0===t)throw Error("State is invalid");if(t.length<1)throw Error("State cannot be an empty array");this._io.emit("reset-list",{name:this._stateName,rev:this._state.rev,state:t})}},{key:"getAll",value:function(){return this._state.data}},{key:"getByIndex",value:function(t){return this._state.data[t]}}]),t}(),HamoniSync=function(){function t(e,n){classCallCheck(this,t),this._accountId=e,this._appId=n,this._reconnectedCallbacks=[],this._disconnectedCallbacks=[]}return createClass(t,[{key:"connect",value:function(){var t=this;return new Promise(function(e,n){t._io=IO(config.serverUrl,{query:{appId:t._appId,accountId:t._accountId}}),t._io.once("connect",function(){e()}),t._io.once("connect_error",function(t){return n(t)}),t._io.once("error",function(t){return n(t)}),t._io.on("reconnect",function(){return t._reconnectedCallbacks.forEach(function(t){return t()})}),t._io.on("disconnect",function(e){var n="";n="io client disconnect"===e?"client disconnect":"server unavailable",t._disconnectedCallbacks.forEach(function(t){return t(n)})})})}},{key:"createValue",value:function(t,e){var n=this;return new Promise(function(a,i){null===e||void 0===e?i("State cannot be empty"):"function"==typeof e||"object"===(void 0===e?"undefined":_typeof(e))?i("State has an invalid type"):n._io.emit("create-value",{name:t,state:e},function(e){e.error?i(e.error):a(new Value(n._appId,n._io,t,e))})})}},{key:"createObject",value:function(t,e){var n=this;return new Promise(function(a,i){"object"!==(void 0===e?"undefined":_typeof(e))||null===e||void 0===e?i("State is invalid"):n._io.emit("create-object",{name:t,state:e},function(e){e.error?i(e.error):a(new Obj(n._appId,n._io,t,e))})})}},{key:"createList",value:function(t,e){var n=this;return new Promise(function(a,i){"Array"!==e.constructor.name||null===e||void 0===e?i("State is invalid"):e.length<1?i("State cannot be an empty array"):n._io.emit("create-list",{name:t,state:e},function(e){e.error?i(e.error):a(new List(n._appId,n._io,t,e))})})}},{key:"get",value:function(t){var e=this;return new Promise(function(n,a){t&&"string"==typeof t?e._io.emit("get-state",t,function(i){i.error?a(i.error):"value"===i.type?n(new Value(e._appId,e._io,t,i)):"object"===i.type?n(new Obj(e._appId,e._io,t,i)):"list"===i.type&&n(new List(e._appId,e._io,t,i))}):a("invalid state name passed as parameter")})}},{key:"onReconnected",value:function(t){if("function"!=typeof t)throw Error("Expected a function but got an invalid parameter type");this._reconnectedCallbacks.push(t)}},{key:"onDisconnected",value:function(t){if("function"!=typeof t)throw Error("Expected a function but got an invalid parameter type");this._disconnectedCallbacks.push(t)}}]),t}();module.exports=HamoniSync;
